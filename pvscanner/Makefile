
# Image URL to use all building/pushing image targets
VERSION ?= latest
IMG ?= pvdf/pvscanner:$(VERSION)

# Currently, only unix executable are generated.
GOARGS = GOOS=linux GOARCH=amd64

default:
	@echo "Provide a target (build, img or push)"

version:
	@echo "// Generated by Makefile\n\npackage lib\n\nvar Version = \"$(VERSION)\"\n" >pkg/lib/version_.go

# Build an executable for local test (Use only on linux system)
.PHONY: pvscanner
build: version
	$(GOARGS) go build -o ./pvscanner

img: version
	cd ..; docker build -f pvscanner/Dockerfile . -t ${IMG}

push: img
	docker push ${IMG}


